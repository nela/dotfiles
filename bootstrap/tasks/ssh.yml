---
- name: Get user info
  ansible.builtin.user:
    name: "{{ user.name }}"
    state: present
  register: user

- name: Create SSH dir
  ansible.builtin.file:
    mode: '0644'
    owner: "{{ user.name }}"
    path: "{{ user.home }}/.ssh"
    state: directory

- name: Generate SSH keypair
  community.crypto.openssh_keypair:
    force: true
    owner: "{{ user.name }}"
    path: "{{ user.home }}/.ssh/id_ed25519"
    type: ed25519
  register: ssh
